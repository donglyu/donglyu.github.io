<!DOCTYPE html>
<html lang="zh-Hans™">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta name="google-site-verification" content="DwDg4EuywHWNZUkTC7sG0WGv_UQekM4uRtOoaGuDJHc">
<meta name="baidu-site-verification" content="hkLiBHH93D">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="CoreData使用记录">




  <meta name="keywords" content="coredata,">




  <link rel="alternate" href="/default" title="LYDSNM'S WORK">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1">



<link rel="canonical" href="http://www.lydsnm.top/2015/12/06/CoreData使用记录学习/">


<meta name="description" content="Core Data是苹果针对Mac和iOS平台开发的一个框架, 通过CoreData可以在本地生成数据库sqlite,提供了ORM的功能，将对象和数据模型相互转换 . 通过Core Data管理和操作. 能够快速达到项目的存储数据的需求.      CoreData优点：能够合理管理内存，避免使用sql的麻烦，高效, 由于是苹果提供的解决方案, 所以不用太过担心会有其他问题.  我的观念就是先使用">
<meta name="keywords" content="coredata">
<meta property="og:type" content="article">
<meta property="og:title" content="CoreData使用记录">
<meta property="og:url" content="http://www.lydsnm.top/2015/12/06/CoreData使用记录学习/index.html">
<meta property="og:site_name" content="LYDSNM&#39;S WORK">
<meta property="og:description" content="Core Data是苹果针对Mac和iOS平台开发的一个框架, 通过CoreData可以在本地生成数据库sqlite,提供了ORM的功能，将对象和数据模型相互转换 . 通过Core Data管理和操作. 能够快速达到项目的存储数据的需求.      CoreData优点：能够合理管理内存，避免使用sql的麻烦，高效, 由于是苹果提供的解决方案, 所以不用太过担心会有其他问题.  我的观念就是先使用">
<meta property="og:locale" content="zh-Hans™">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1106214-2fa5fda1a8bff45e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1106214-265946bce916ef5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-03-04T15:41:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CoreData使用记录">
<meta name="twitter:description" content="Core Data是苹果针对Mac和iOS平台开发的一个框架, 通过CoreData可以在本地生成数据库sqlite,提供了ORM的功能，将对象和数据模型相互转换 . 通过Core Data管理和操作. 能够快速达到项目的存储数据的需求.      CoreData优点：能够合理管理内存，避免使用sql的麻烦，高效, 由于是苹果提供的解决方案, 所以不用太过担心会有其他问题.  我的观念就是先使用">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1106214-2fa5fda1a8bff45e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">


  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: true
    },
  };
</script>




  




  <link href="/plugins/prettify/prettify.css" rel="stylesheet">


<!--百度统计-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b733e1eaeacbf8f87d3be047f28c3973";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <title> CoreData使用记录 - LYDSNM'S WORK </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">LYDSNM'S WORK</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    
                        <li class="menu-item">
                    
                        <a href="/">
                            
                            
                                首页
                            
                        </a>
                    </li>
                
                    
                        <li class="menu-item">
                    
                        <a href="/archives">
                            
                            
                                归档
                            
                        </a>
                    </li>
                
                    
                        <li class="menu-item">
                    
                        <a href="http://life.lydsnm.top">
                            
                            
                                生活
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          CoreData使用记录
        
      </h1>

      <time class="post-time">
          2015-12-06
      </time>
    </header>



    
            
  <div class="toc-container">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-使用CoreData"><span class="toc-text">1.使用CoreData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-NSFetchRequest-常用方法-setEntity"><span class="toc-text">2.NSFetchRequest 常用方法 -setEntity:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-其他记录"><span class="toc-text">3.其他记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-问题记录"><span class="toc-text">4.问题记录</span></a></li></ol>
  </div> 


            <div class="post-content">
                <p>Core Data是苹果针对Mac和iOS平台开发的一个框架, 通过CoreData可以在本地生成数据库sqlite,提供了ORM的功能，将对象和数据模型相互转换 . 通过Core Data管理和操作. 能够快速达到项目的存储数据的需求.<br>      CoreData优点：能够合理管理内存，避免使用sql的麻烦，高效, 由于是苹果提供的解决方案, 所以不用太过担心会有其他问题.  我的观念就是先使用上了后再考虑其他, 问题有一个就解决一个.<br>Core Data 默认使用Sqlite. 因此在沙盒Document文件夹中找到.sqlite的数据库文件. </p>
<p> 这里顺便提一个一个比较好用的快速打开模拟器沙盒路径的工具: <a href="https://github.com/opensim/opensim" target="_blank" rel="noopener">https://github.com/opensim/opensim</a></p>
<h3 id="1-使用CoreData"><a href="#1-使用CoreData" class="headerlink" title="1.使用CoreData"></a>1.使用CoreData</h3><ol>
<li>创建工程时, 勾选Use Core Data</li>
<li>手动添加, (如何要想向创建时没有选择Use Core Data<br>如果不知道该添加什么, 一个比较便捷的方法, 是直接新建一个空白工程, 勾选Use Core Data后, 对比AppDelegate.h中的代码, 然后再将多的内容添加到工程中.)</li>
</ol>
<a id="more"></a>
<p>添加Core Data后, 在AppDelegate.h中就有帮我们生成用于管理、存储这些模型的对象，我们可以通过添加AppDelegate头文件来使用.<br>添加Core Data后, 就是建立数据模型,说到模型, 就要提一下Core Data常用的6个对象：</p>
<blockquote>
<p>1、NSManagedObjectContext<br>管理对象，上下文，持久性存储模型对象<br>2、NSManagedObjectModel<br>被管理的数据模型，数据结构<br>3、NSPersistentStoreCoordinator<br>连接数据库的<br>4、NSManagedObject<br>被管理的数据记录<br>5、NSFetchRequest<br>数据请求<br>6、NSEntityDescription<br>表格实体结构<br>此外还需要知道.xcdatamodel文件编译后为.momd或者.mom文件  </p>
</blockquote>
<p>一.开始  </p>
<blockquote>
<p>右键添加一个Core data -&gt; Data Model(如果创建工程时, 直接勾选use core data, 会直接默认生成.xcdatamodeld).<br>选中.xcdatamodeld主要使用到了下列一些东西:<br>Entity: 实体(我们要生成的模型对象的实体, User, Car, Person等等)<br>Attributes:实体对象属性<br>ReaationShips:关系<br>Fetched Properties:</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1106214-2fa5fda1a8bff45e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="&gt;_&lt;"></p>
<p>另外多表关联内容可以看看: <a href="http://www.jianshu.com/p/e9f3b5e0cd19" target="_blank" rel="noopener">http://www.jianshu.com/p/e9f3b5e0cd19</a></p>
<p>二.创建实体管理 </p>
<p>右键添加一个Core data -&gt; NSManagedObject subclass, 一直选择,  选中Car, Wheel.  到最后会实现<br><img src="http://upload-images.jianshu.io/upload_images/1106214-265946bce916ef5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20151206-1"></p>
<p>三.导入AppDelegate.h头文件, 开始管理数据库  </p>
<p>主要操作:</p>
<pre><code class="objc">//先取出coredata上下文管理者
AppDelegate *appDelegate = [[UIApplication sharedApplication] delegate];
NSManagedObjectContext *context = appDelegate.managedObjectContext;

//1.保存新数据
Car *car = [NSEntityDescription insertNewObjectForEntityForName: @&quot;Car&quot; inManagedObjectContext: context];
car.carName = label1.text;
car.carType = label2.text;
[appDelegate saveContext];

//2.查询数据
NSError *error;
NSFetchRequest *request = [NSFetchRequest new];
NSEntityDescription *entity = [NSEntityDescription entityForName: @&quot;Car&quot; inManagedObjectContext: context];
[request setEntity: entity];
NSPredicate *predicate = [NSPredicate predicateWithFormat:@&quot;carName=%@&quot;, carName];
[request setPredicate:predicate];
NSArray *results = [[context executeFetchRequest: request error: &amp;error] copy];
for (Car *car in results) {
　    NSLog(@&quot;%@&quot;, car.carName);
}

//3.更新数据
{
NSFetchRequest** request=[[NSFetchRequest alloc] init];
NSEntityDescription *car=NSEntityDescription entityForName:@&quot;car&quot; inManagedObjectContext:_myAppDelegate.managedObjectContext];  
[request setEntity:car];
///查询条件
NSPredicate* predicate=[NSPredicate predicateWithFormat:@&quot;carName==%@&quot;,@&quot;name&quot;];
 [request setPredicate:predicate];
NSError* error=nil;
NSMutableArray* mutableFetchResult=[[_myAppDelegate.managedObjectContext executeFetchRequest:request error:&amp;error] mutableCopy]; 
if (mutableFetchResult==nil) {
　NSLog(@&quot;Error:%@&quot;,error); 
}
NSLog(@&quot;The count of entry: %i&quot;,[mutableFetchResult count]);  
 for (Car* car in mutableFetchResult) {  
　car.carName = @&quot;name1&quot;  ;
    ...    
} 
//更新后要进行保存，否则没更新  
[_myAppDelegate.managedObjectContext save:&amp;error];
}  

//4.删除数据  
  {
  NSFetchRequest* request=[[NSFetchRequest alloc] init];  
      NSEntityDescription* car=[NSEntityDescription entityForName:@&quot;Car&quot; inManagedObjectContext:_myAppDelegate.managedObjectContext];  
      [request setEntity:car];  
      NSPredicate* predicate=[NSPredicate predicateWithFormat:@&quot;carName==%@&quot;,@&quot;name&quot;];  
      [request setPredicate:predicate];  
      NSError* error=nil;  
      NSMutableArray* mutableFetchResult=[[_myAppDelegate.managedObjectContext executeFetchRequest:request error:&amp;error] mutableCopy];  
      if (mutableFetchResult==nil) {  
  　 NSLog(@&quot;Error:%@&quot;,error);  
      }  
      NSLog(@&quot;The count of entry: %i&quot;,[mutableFetchResult count]);  
      for (Car *car in mutableFetchResult) {  
  　　 [_myAppDelegate.managedObjectContext deleteObject:car];  
      }  
      if ([_myAppDelegate.managedObjectContext save:&amp;error]) {  
  　NSLog(@&quot;Error:%@,%@&quot;,error,[error userInfo]);  
  　}  
  }

</code></pre>
<ul>
<li>条件查询的更多内容, 可以查看官方文档:<br><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Predicates/Articles/pCreating.html" target="_blank" rel="noopener">https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Predicates/Articles/pCreating.html</a></li>
</ul>
<h3 id="2-NSFetchRequest-常用方法-setEntity"><a href="#2-NSFetchRequest-常用方法-setEntity" class="headerlink" title="2.NSFetchRequest 常用方法 -setEntity:"></a>2.NSFetchRequest 常用方法 -setEntity:</h3><p>设置你要查询的数据对象的类型（Entity）</p>
<ul>
<li>-setPredicate:<br>设置查询条件</li>
<li>-setFetchLimit:<br>设置最大查询对象数目</li>
<li>-setSortDescriptors:<br>设置查询结果的排序方法  </li>
</ul>
<ul>
<li>-setAffectedStores:<br>设置可以在哪些数据存储中查询<br>[request setFetchBatchSize:500];//从数据库里每次加载500条数据来筛选数据<br>[request setFetchOffset:sizeCount];//读取数据库的游标偏移量，从游标开始读取数据<br>sizeCount = 10;<br>[request setFetchLimit:10];//每次要取多少条数据，10就是每次从数据库读取10条数据<br>NSPredicate用于查询和过滤<br>在SQL中作为查询条件通常用WHERE，但在COREDATA中作为查询条件就可以用到NSPredicate.<br>NSPredicate 不单可以和COREDATA中的FetchRequest 配合使用。也可以与NSArray配合使用<br>一个线程用一个NSManagedObjectContext对象.<br>使用coredata 在项目中建立表，它会自己来生成数据库，而在每个表中都有它自己生成的Z_PK,Z_ENT,Z_OPT 这三个字段，<br>Z_PK     表的主键，从1开始递增， 具有唯一性<br>可以通过主键访问和获取对象的途径:</li>
</ul>
<pre><code class="objc">  NSFetchRequest* request = [[NSFetchRequest alloc] init];
  request setEntity:entity];
  [request setResultType:NSManagedObjectIDResultType];
  [request setFetchBatchSize:20];
  NSError* error = nil;
  NSArray* items = [context executeFetchRequest:request error:&amp;error];
  for (NSManagedObjectID* objectID in items) {
  　NSManagedObject* object = [context objectWithID:objectID];
      ...
  }
</code></pre>
<p>Z_ENT  表在xcdatamodel 中的索引值，如果有6个表那么它的值的区间就是[1,6 ]<br>Z_OPT  表示的是每条数据被操作的次数，初始化值为1，只要是增删改查都会加1</p>
<h3 id="3-其他记录"><a href="#3-其他记录" class="headerlink" title="3.其他记录"></a>3.其他记录</h3><blockquote>
<p>方便查阅<br>1.通过core data存储任意类型的数据:<a href="http://blog.csdn.net/likendsl/article/details/8549333" target="_blank" rel="noopener">http://blog.csdn.net/likendsl/article/details/8549333</a><br>2.多表关联时, 动态设置删除关系.:<a href="http://blog.csdn.net/fengsh998/article/details/8090111" target="_blank" rel="noopener">http://blog.csdn.net/fengsh998/article/details/8090111</a><br>3.批量操作、聚合操作、WWDC 2015新特性: <a href="http://www.cocoachina.com/ios/20150730/12785.html" target="_blank" rel="noopener">http://www.cocoachina.com/ios/20150730/12785.html</a>  </p>
</blockquote>
<h3 id="4-问题记录"><a href="#4-问题记录" class="headerlink" title="4.问题记录"></a>4.问题记录</h3><blockquote>
<p>当查询返回数据是fault时,  可以加上这句试试:<br>[request setReturnsObjectsAsFaults:NO];</p>
</blockquote>
<p>学习记录, 难免可能会有不准确的, 多多包涵~~</p>
<p>End!</p>

            </div>
          

    
      <footer class="post-footer">
     
		
		<div class="post-tags">
		  
			<a href="/tags/coredata/">coredata</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2015/12/07/iOS-GCD记录/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">iOS GCD记录</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2015/11/07/iOS动画整理/">
        <span class="next-text nav-default">iOS动画整理</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">加载 Disqus 评论</button>
    </div>
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>
      
        

<script type="text/javascript">
  var disqus_shortname = 'donglyu';
  var disqus_identifier = '2015/12/06/CoreData使用记录学习/';

  var disqus_title = "CoreData使用记录";


  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>




      
      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2020
    <span class="footer-author">lydsnm.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  



    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

<!--prettify代码高亮脚本引入-->

    <script src="/plugins/prettify/prettify.js"></script>
    <script type="text/javascript">
    jQuery(function($){
        $('pre').addClass('prettyprint');
        prettyPrint();
    });
    </script>


  </body>
</html>
